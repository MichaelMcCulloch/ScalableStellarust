---
- name: Copy and apply letsencrypt_issuer.yml
  block:
    - name: Copy letsencrypt_issuer.yml
      copy:
        src: letsencrypt_issuer.yml
        dest: $HOME/
        backup: no

    - name: create letsencrypt_issuer.yml
      shell: kubectl apply -f $HOME/letsencrypt_issuer.yml

- name: Get a certificate
  block:
    - name: Copy certificate.yml
      template:
        src: certificate.yml.j2
        dest: $HOME/certificate.yml
        backup: no

    - name: Apply certificate.yml
      shell: kubectl apply -f $HOME/certificate.yml
