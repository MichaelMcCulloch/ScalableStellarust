---
- name: Define Ingress
  kubernetes.core.k8s:
    state: present
    definition:
      apiVersion: networking.k8s.io/v1
      kind: Ingress
      metadata:
        name: "{{k8s_dash.ingress_name}}"
        namespace: kubernetes-dashboard
        labels:
          k8s-app: kubernetes-dashboard
        annotations:
          nginx.ingress.kubernetes.io/ssl-passthrough: "true"
          nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
          nginx.ingress.kubernetes.io/rewrite-target: /
          nginx.ingress.kubernetes.io/auth-type: basic
          nginx.ingress.kubernetes.io/auth-secret: htpasswd-dashboard
          nginx.ingress.kubernetes.io/auth-realm: "Restricted Area"
          cert-manager.io/issuer: "{{k8s_dash.issuer_name}}"
      spec:
        ingressClassName: nginx
        tls:
          - hosts:
              - "{{ingress_spec_tls_hosts}}"
            secretName: "{{k8s_dash.cert_secret_name}}"
        rules:
          - host: "{{ingress_spec_rules_host}}"
            http:
              paths:
                - pathType: Prefix
                  path: /
                  backend:
                    service:
                      name: kubernetes-dashboard
                      port:
                        number: "{{ingress_port}}"
