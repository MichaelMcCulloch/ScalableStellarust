---
- name: Check if Cert Manager namespace exists
  register: certmanagernamespace
  failed_when: false
  shell: kubectl get pods  --namespace=cert-manager | awk '{ print $1}' | grep cert-manager

# Install cert-manager3
# Note: Currently we must set hostNetwork=true otherwise it will fail to resolve the pods it needs.
#   This is definitely wrong, as it breaks when installing the ingress

- name: Install Cert Manager
  when: certmanagernamespace.stdout == ""
  shell: >
    helm install \
      cert-manager jetstack/cert-manager \
      --namespace cert-manager \
      --create-namespace \
      --version v1.8.0 \
      --set installCRDs=true
