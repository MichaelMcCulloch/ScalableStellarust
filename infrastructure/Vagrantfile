Vagrant.configure("2") do |config|

    config.vm.box = "archlinux/archlinux"
    config.ssh.forward_agent = true
    config.vm.synced_folder ".", "/vagrant", disabled: true
    config.vm.synced_folder "./data", "/data", type: "rsync", rsync__auto: true, mount_options: ["dmode=777,fmode=777"]
  
    config.vm.provider "libvirt" do |lv|
      lv.memory = 8192
      lv.cpus = 32
      lv.nested = true
			lv.default_prefix = "stellarustCluster_"
    end

    config.vm.network "private_network", 
      :dev => "virbr1", 
      :mode => "bridge", 
      :type => "dhcp", 
      :libvirt__domain_name => "datacenter.local",
      :libvirt__network_name => "datacenter.local",
      :libvirt__network_address => "172.28.128.0/24"

      (1..1).each do |i|
        name = "gamehost-#{i.to_s.rjust(2, "0")}"
  
        config.vm.define "#{name}" do |manager_machine|

					manager_machine.vm.hostname = "#{name}"
        end
  
      end


      (1..2).each do |i|
        name = "client-#{i.to_s.rjust(2, "0")}"
  
        config.vm.define "#{name}" do |manager_machine|

					manager_machine.vm.hostname = "#{name}"
        end
  
      end

      name = "haproxy"
      config.vm.define "#{name}" do |manager_machine|
					manager_machine.vm.hostname = "#{name}"
      end
     
      (1..10).each do |i|
        name = "element-#{i.to_s.rjust(2, "0")}"
  
        config.vm.define "#{name}" do |manager_machine|

					manager_machine.vm.hostname = "#{name}"
        end
  
      end

      config.vm.provision "ansible" do |ansible|
        ansible.playbook = "config.yml"
      end

      config.vm.provision :reload
end